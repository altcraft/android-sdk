
# README ALTCRAFT ANDROID EXAMPLE APP

## Подготовка приложения

- Выполните загрузку репозитория  
- Откройте проект в Android Studio  

Проект был разработан на:  
- Android Studio **Meerkat Feature Drop | 2024.3.2 Patch 1**  
- Kotlin **1.9.22**  
- AGP **8.10.1**  

---

### Подготовка приложения для тестирования уведомлений FCM

- Добавьте файлы `google.services.json` в папку **example** проекта  
- В файле `build.gradle` модуля приложения раскомментируйте добавление плагина:  
  ```kotlin
  alias(libs.plugins.google.gms.google.services)
````

### Подготовка приложения для тестирования уведомлений HMS

* Добавьте файлы `agconnect-services.json` в папку **example** проекта
* В файле `build.gradle` модуля приложения раскомментируйте добавление плагина:

  ```kotlin
  id("com.huawei.agconnect")
  ```

### Подготовка приложения для тестирования уведомлений RuStore

* Инициализируйте клиент RuStore в функции `Application.onCreate()` модуля приложения, указав ID проекта
* Для корректной работы уведомлений RuStore приложение **RuStore** должно быть установлено на устройстве

---

## Инициализация SDK без использования интерфейса программы

Вы можете создать переменную конфигурации и выполнить инициализацию SDK без использования интерфейса программы с помощью кода:

```kotlin
// Конфигурация SDK
val config = AltcraftConfiguration.Builder(
    apiUrl = "your-api-url"
).build()

// Инициализация
AltcraftSDK.initialization(this, config)
```

Подробная информация о конфигурации SDK и описание всех параметров приведена в README SDK.

---

## Установка JWT токенов без использования интерфейса программы

* Перейдите в класс **App** модуля приложения
* Укажите значение JWT-токена для базы данных анонимных пользователей в переменной `anonJWT`
* Укажите значение JWT-токена для базы данных зарегистрированных пользователей в переменной `regJWT`

---

## Установите приложение на устройство

После выполнения шагов по подготовке выполните установку приложения на устройство.

---

## Навигация приложения

### Home

Раздел приложения:

* содержит информацию о текущем токене, дате обновления токена, имени пользователя, статусе подписки, событиях SDK
* позволяет выполнять основные запросы SDK с помощью элементов пользовательского интерфейса

Элементы раздела:

* кнопки динамической смены приоритетного push-провайдера (**fcm**, **hms**, **rustore**) — левый верхний угол
* информация об используемом push-токене, дате его последнего обновления, имени текущего пользователя — верхняя часть экрана
* индикатор статуса подписки на push-уведомления:

  * зеленый — подписка активна (*subscribed*)
  * желтый — подписка приостановлена (*suspended*)
  * красный — подписка отменена или еще не создана (*unsubscribed*)

**Раздел Actions**:

* **Subscribe to push** — открывает управление подписками:

  * **Subscribe** — выполняет подписку на push-уведомления
  * **Suspend** — приостанавливает подписку
  * **Unsubscribe** — отменяет подписку
  * **Log In** — меняет JWT-токен с анонимного на зарегистрированный → вызывает `unSuspend()` → подписывает на push-уведомления, если `unSuspend()` вернул `null`
  * **Log Out** — меняет JWT-токен с зарегистрированного на анонимный → вызывает `unSuspend()` → подписывает на push-уведомления, если `unSuspend()` вернул `null`
* **Get profile status** — показывает информацию о профиле
* **Update device token** — удаляет текущий push-токен → запрашивает новый → обновляет профиль
* **Clear SDK cache** — очищает данные SDK, останавливает задачи SDK, очищает события SDK в разделе *Main Events*

**Раздел Main Events** — публикует информацию о событиях SDK (код события, сообщение, дата события)

---

### Example

Раздел приложения для создания тестового push-уведомления с помощью билдера SDK и его отправки в системную панель уведомлений.

Элементы:

* превью уведомления после отрисовки билдером (верхняя часть экрана)
* **Text setting**:

  * кнопка **X** — очистка введенной информации
  * кнопка **+** — сохранение информации
  * установка *title*
  * установка *body*
* **Image setting**:

  * кнопка **X** — очистка информации
  * кнопка **+** — загрузка и сохранение изображения по ссылке
  * установка *small image* — ссылка на изображение
  * установка *large image (banner)* — ссылка на изображение
* **Buttons setting**:

  * кнопка **X** — удаление созданных кнопок
  * кнопка **+** — создание новой кнопки уведомления
* кнопка **Send push** — отправляет созданное уведомление в панель уведомлений

---

### Logs

Раздел, содержащий список сообщений SDK, извлеченных из событий.

---

### Config

Раздел для установки параметров конфигурации SDK, JWT-токенов, параметров подписки на push-уведомления.

**Config setting**:

* кнопка **X** — очистка информации
* кнопка **+** — сохранение информации
* поле **API url** — установка параметра `apiUrl` (обязательный)
* поле **RToken** — установка параметра `rToken` (для авторизации по ролевому токену)
* панель **Providers** — приоритет push-провайдеров
* поле **S.Msg** — при заполнении SDK использует foreground-сервисы для запросов подписки и обновления push-токена, отображая уведомление с указанным текстом

**JWT setting**:

* кнопка **X** — очистка информации
* кнопка **+** — сохранение информации
* поле **Anon.JWT** — JWT-токен для анонимных пользователей
* поле **Reg.JWT** — JWT-токен для зарегистрированных пользователей

**Subscribe setting**:

* переключатель **sync** — синхронный / асинхронный запрос
* переключатель **replace** — флаг инклюзивности подписки
* переключатель **skipTriggers** — при включении подписка игнорирует триггеры кампаний
* **Fields & Cats values** — настройка пользовательских полей подписки, полей профиля и категорий подписки:

  * **C.Fields** — пользовательские поля подписки

    * кнопка **+** — добавление нового поля
  * **P.Fields** — поля профиля

    * кнопка **+** — добавление нового поля
  * **Cats** — категории подписки

    * кнопка **+** — добавление новой категории

---

**Обратите внимание**: при использовании JWT-авторизации сначала укажите и сохраните значения JWT-токенов, затем сохраните параметры конфигурации.




